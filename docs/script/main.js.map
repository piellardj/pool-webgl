{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/ts/controls.ts","webpack:///./src/ts/gl-utils/fbo.ts","webpack:///./src/ts/gl-utils/gl-resource.ts","webpack:///./src/ts/gl-utils/shader.ts","webpack:///./src/ts/gl-utils/utils.ts","webpack:///./src/ts/gl-utils/vbo.ts","webpack:///./src/ts/gl-utils/viewport.ts","webpack:///./src/ts/main.ts","webpack:///./src/ts/orbitalCamera.ts","webpack:///./src/ts/viewer/caustics-shaders.ts","webpack:///./src/ts/viewer/caustics.ts","webpack:///./src/ts/viewer/viewer.ts","webpack:///./src/ts/viewer/viewer2D-shaders.ts","webpack:///./src/ts/viewer/viewer2D.ts","webpack:///./src/ts/viewer/viewer3D-shaders.ts","webpack:///./src/ts/viewer/viewer3D.ts","webpack:///./src/ts/viewer/viewerCommon.ts","webpack:///./src/ts/water-shaders.ts","webpack:///./src/ts/water.ts"],"names":[],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/ts/main.ts\");\n","import Water from \"./water\";\r\nimport Viewer2D from \"./viewer/viewer2D\";\r\nimport Viewer3D from \"./viewer/viewer3D\";\r\n\r\nimport \"./page-interface-generated\";\r\n\r\nfunction bindControls(water: Water, viewer2D: Viewer2D, viewer3D: Viewer3D): void {\r\n    {\r\n        const RESOLUTION_CONTROL_ID = \"quality\";\r\n        const setResolution = (resolution: string[]) => {\r\n            const size = +resolution[0];\r\n            water.reset(size, size);\r\n        }\r\n        Page.Tabs.addObserver(RESOLUTION_CONTROL_ID, setResolution);\r\n        setResolution(Page.Tabs.getValues(RESOLUTION_CONTROL_ID));\r\n    }\r\n    {\r\n        const RAIN_CONTROL_ID = \"rain-checkbox-id\";\r\n        const updateRain = (enable: boolean) => { water.rain = enable; };\r\n        Page.Checkbox.addObserver(RAIN_CONTROL_ID, updateRain);\r\n        updateRain(Page.Checkbox.isChecked(RAIN_CONTROL_ID));\r\n    }\r\n    {\r\n        const TENSION_CONTROL_ID = \"surface-tension-range-id\";\r\n        const updateTension = (tension: number) => { water.surfaceTension = tension; };\r\n        Page.Range.addObserver(TENSION_CONTROL_ID, updateTension);\r\n        updateTension(Page.Range.getValue(TENSION_CONTROL_ID));\r\n    }\r\n    {\r\n        const SPRING_CONTROL_ID = \"stiffness-range-id\";\r\n        const updateSpring = (stiffness: number) => { water.springStiffness = stiffness; };\r\n        Page.Range.addObserver(SPRING_CONTROL_ID, updateSpring);\r\n        updateSpring(Page.Range.getValue(SPRING_CONTROL_ID));\r\n    }\r\n    {\r\n        const DISPERSION_CONTROL_ID = \"dispersion-range-id\";\r\n        const updateDispersion = (dispersion: number) => { water.dispersion = dispersion; };\r\n        Page.Range.addObserver(DISPERSION_CONTROL_ID, updateDispersion);\r\n        updateDispersion(Page.Range.getValue(DISPERSION_CONTROL_ID));\r\n    }\r\n\r\n    {\r\n        const SPECULAR_CONTROL_ID = \"specular-checkbox-id\";\r\n        const updateSpecular = (enable: boolean) => {\r\n            viewer2D.specular = enable;\r\n            viewer3D.specular = enable;\r\n        };\r\n        Page.Checkbox.addObserver(SPECULAR_CONTROL_ID, updateSpecular);\r\n        updateSpecular(Page.Checkbox.isChecked(SPECULAR_CONTROL_ID));\r\n    }\r\n    {\r\n        const CAUSTICS_CONTROL_ID = \"caustics-checkbox-id\";\r\n        const updateCaustics = (enable: boolean) => {\r\n            viewer2D.caustics = enable;\r\n            viewer3D.caustics = enable;\r\n        };\r\n        Page.Checkbox.addObserver(CAUSTICS_CONTROL_ID, updateCaustics);\r\n        updateCaustics(Page.Checkbox.isChecked(CAUSTICS_CONTROL_ID));\r\n    }\r\n    {\r\n        const FRESNEL_CONTROL_ID = \"fresnel-checkbox-id\";\r\n        const updateSpecular = (enable: boolean) => {\r\n            viewer2D.fresnel = enable;\r\n            viewer3D.fresnel = enable;\r\n        };\r\n        Page.Checkbox.addObserver(FRESNEL_CONTROL_ID, updateSpecular);\r\n        updateSpecular(Page.Checkbox.isChecked(FRESNEL_CONTROL_ID));\r\n    }\r\n    {\r\n        const AMPLITUDE_CONTROL_ID = \"amplitude-range-id\";\r\n        const updateAmplitude = (amplitude: number) => {\r\n            viewer2D.amplitude = amplitude;\r\n            viewer3D.amplitude = amplitude;\r\n        };\r\n        Page.Range.addObserver(AMPLITUDE_CONTROL_ID, updateAmplitude);\r\n        updateAmplitude(Page.Range.getValue(AMPLITUDE_CONTROL_ID));\r\n    }\r\n    {\r\n        const LEVEL_CONTROL_ID = \"level-range-id\";\r\n        const updateWaterLevel = (level: number) => {\r\n            viewer2D.waterLevel = level;\r\n            viewer3D.waterLevel = level;\r\n        };\r\n        Page.Range.addObserver(LEVEL_CONTROL_ID, updateWaterLevel);\r\n        updateWaterLevel(Page.Range.getValue(LEVEL_CONTROL_ID));\r\n    }\r\n    {\r\n        const OPACITY_CONTROL_ID = \"opacity-range-id\";\r\n        const updateOpacity = (opacity: number) => {\r\n            viewer2D.opacity = opacity;\r\n            viewer3D.opacity = opacity;\r\n        };\r\n        Page.Range.addObserver(OPACITY_CONTROL_ID, updateOpacity);\r\n        updateOpacity(Page.Range.getValue(OPACITY_CONTROL_ID));\r\n    }\r\n    {\r\n        const ETA_CONTROL_ID = \"refraction-range-id\";\r\n        const updateEta = (eta: number) => {\r\n            viewer2D.eta = eta;\r\n            viewer3D.eta = eta;\r\n        };\r\n        Page.Range.addObserver(ETA_CONTROL_ID, updateEta);\r\n        updateEta(Page.Range.getValue(ETA_CONTROL_ID));\r\n    }\r\n}\r\n\r\nfunction bind(water: Water, viewer2D: Viewer2D, viewer3D: Viewer3D): void {\r\n    bindControls(water, viewer2D, viewer3D);\r\n}\r\n\r\nfunction bindRendererChooser(choose2D: () => void, choose3D: () => void) {\r\n    function bindViewer(viewerStr: string[]) {\r\n        if (viewerStr[0] === \"2D\") {\r\n            choose2D();\r\n        } else {\r\n            choose3D();\r\n        }\r\n    }\r\n    const VIEWER_CONTROL_ID = \"viewer\";\r\n    Page.Tabs.addObserver(VIEWER_CONTROL_ID, bindViewer);\r\n    bindViewer(Page.Tabs.getValues(VIEWER_CONTROL_ID));\r\n}\r\n\r\nexport { bind, bindRendererChooser };","import GLResource from \"./gl-resource\";\r\nimport Viewport from \"./viewport\";\r\n\r\nclass FBO extends GLResource {\r\n    id: WebGLFramebuffer;\r\n    width: number;\r\n    height: number;\r\n\r\n    constructor(gl: WebGLRenderingContext, width: number, height: number) {\r\n        super(gl);\r\n        \r\n        this.id = gl.createFramebuffer();\r\n        this.width = width;\r\n        this.height = height;\r\n    }\r\n\r\n    public bind(colorBuffers: WebGLTexture[], depthBuffer: WebGLRenderbuffer = null): void {\r\n        const gl = super.gl();\r\n\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.id);\r\n        gl.viewport(0, 0, this.width, this.height);\r\n      \r\n        for (let i = 0; i < colorBuffers.length; ++i) {\r\n          gl.framebufferTexture2D(\r\n            gl.FRAMEBUFFER, gl['COLOR_ATTACHMENT' + i], gl.TEXTURE_2D, colorBuffers[i], 0);\r\n        }\r\n        \r\n        if (depthBuffer) {\r\n          gl.bindRenderbuffer(gl.RENDERBUFFER, depthBuffer);\r\n          gl.framebufferRenderbuffer(\r\n            gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, depthBuffer);\r\n        }\r\n    }\r\n\r\n    public static bindDefault(gl: WebGLRenderingContext, viewport: Viewport=null): void {\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n\r\n        if (viewport === null) {\r\n            gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\r\n        } else {\r\n            gl.viewport(viewport.left, viewport.lower, viewport.width, viewport.height);\r\n        }\r\n\r\n    }\r\n\r\n    public freeGLResources(): void {\r\n        super.gl().deleteFramebuffer(this.id);\r\n        this.id = null;\r\n    }\r\n}\r\n\r\nexport default FBO;","abstract class GLResource {\r\n  private _gl: WebGLRenderingContext;\r\n\r\n  constructor(gl: WebGLRenderingContext) {\r\n    this._gl = gl;\r\n  }\r\n  \r\n  public gl(): WebGLRenderingContext {\r\n    return this._gl;\r\n  }\r\n  public abstract freeGLResources(): void;\r\n}\r\n\r\nexport default GLResource;","import GLResource from \"./gl-resource\";\r\nimport VBO from \"./vbo\";\r\n\r\nfunction notImplemented(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: any): void {\r\n  alert(\"NOT IMPLEMENTED YET\");\r\n}\r\n\r\nfunction bindUniformFloat(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number): void;\r\nfunction bindUniformFloat(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void;\r\nfunction bindUniformFloat(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: any): void {\r\n  if (Array.isArray(value)) {\r\n    gl.uniform1fv(location, value);\r\n  } else {\r\n    gl.uniform1f(location, value);\r\n  }\r\n}\r\n\r\nfunction bindUniformFloat2v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n  gl.uniform2fv(location, value);\r\n}\r\n\r\nfunction bindUniformFloat3v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n  gl.uniform3fv(location, value);\r\n}\r\n\r\nfunction bindUniformFloat4v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n  gl.uniform4fv(location, value);\r\n}\r\n\r\nfunction bindUniformInt(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number): void;\r\nfunction bindUniformInt(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void;\r\nfunction bindUniformInt(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: any): void {\r\n  if (Array.isArray(value)) {\r\n    gl.uniform1iv(location, value);\r\n  } else {\r\n    gl.uniform1iv(location, value);\r\n  }\r\n}\r\n\r\nfunction bindUniformInt2v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n  gl.uniform2iv(location, value);\r\n}\r\n\r\nfunction bindUniformInt3v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n  gl.uniform3iv(location, value);\r\n}\r\n\r\nfunction bindUniformInt4v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n  gl.uniform4iv(location, value);\r\n}\r\n\r\nfunction bindUniformBool(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: boolean | number): void {\r\n  gl.uniform1i(location, +value);\r\n}\r\n\r\nfunction bindUniformBool2v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value): void {\r\n  gl.uniform2iv(location, value);\r\n}\r\n\r\nfunction bindUniformBool3v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value): void {\r\n  gl.uniform3iv(location, value);\r\n}\r\n\r\nfunction bindUniformBool4v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value): void {\r\n  gl.uniform4iv(location, value);\r\n}\r\n\r\nfunction bindUniformFloatMat2(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n  gl.uniformMatrix2fv(location, false, value);\r\n}\r\n\r\nfunction bindUniformFloatMat3(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n  gl.uniformMatrix3fv(location, false, value);\r\n}\r\n\r\nfunction bindUniformFloatMat4(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n  gl.uniformMatrix4fv(location, false, value);\r\n}\r\n\r\nfunction bindSampler2D(gl: WebGLRenderingContext, location: WebGLUniformLocation, unitNb: number, value: WebGLTexture): void {\r\n  gl.uniform1i(location, unitNb);\r\n  gl.activeTexture(gl['TEXTURE' + unitNb]);\r\n  gl.bindTexture(gl.TEXTURE_2D, value);\r\n}\r\n\r\nfunction bindSamplerCube(gl: WebGLRenderingContext, location: WebGLUniformLocation, unitNb: number, value: WebGLTexture): void {\r\n  gl.uniform1i(location, unitNb);\r\n  gl.activeTexture(gl['TEXTURE' + unitNb]);\r\n  gl.bindTexture(gl.TEXTURE_CUBE_MAP, value);\r\n}\r\n\r\ninterface Type {\r\n  str: string;\r\n  binder;//: (gl: WebGLRenderingContext, location: WebGLUniformLocation, value: any) => void;// |\r\n  //((gl: WebGLRenderingContext, location: WebGLUniformLocation, unitNb: number, value: WebGLTexture) => void);\r\n};\r\n\r\n/* From WebGL spec:\r\n* http://www.khronos.org/registry/webgl/specs/latest/1.0/#5.14 */\r\nconst types = {\r\n  0x8B50: { str: 'FLOAT_VEC2', binder: bindUniformFloat2v },\r\n  0x8B51: { str: 'FLOAT_VEC3', binder: bindUniformFloat3v },\r\n  0x8B52: { str: 'FLOAT_VEC4', binder: bindUniformFloat4v },\r\n  0x8B53: { str: 'INT_VEC2', binder: bindUniformInt2v },\r\n  0x8B54: { str: 'INT_VEC3', binder: bindUniformInt3v },\r\n  0x8B55: { str: 'INT_VEC4', binder: bindUniformInt4v },\r\n  0x8B56: { str: 'BOOL', binder: bindUniformBool },\r\n  0x8B57: { str: 'BOOL_VEC2', binder: bindUniformBool2v },\r\n  0x8B58: { str: 'BOOL_VEC3', binder: bindUniformBool3v },\r\n  0x8B59: { str: 'BOOL_VEC4', binder: bindUniformBool4v },\r\n  0x8B5A: { str: 'FLOAT_MAT2', binder: bindUniformFloatMat2 },\r\n  0x8B5B: { str: 'FLOAT_MAT3', binder: bindUniformFloatMat3 },\r\n  0x8B5C: { str: 'FLOAT_MAT4', binder: bindUniformFloatMat4 },\r\n  0x8B5E: { str: 'SAMPLER_2D', binder: bindSampler2D },\r\n  0x8B60: { str: 'SAMPLER_CUBE', binder: bindSamplerCube },\r\n  0x1400: { str: 'BYTE', binder: notImplemented },\r\n  0x1401: { str: 'UNSIGNED_BYTE', binder: notImplemented },\r\n  0x1402: { str: 'SHORT', binder: notImplemented },\r\n  0x1403: { str: 'UNSIGNED_SHORT', binder: notImplemented },\r\n  0x1404: { str: 'INT', binder: bindUniformInt },\r\n  0x1405: { str: 'UNSIGNED_INT', binder: notImplemented },\r\n  0x1406: { str: 'FLOAT', binder: bindUniformFloat }\r\n};\r\n\r\ninterface ShaderUniform {\r\n  value: boolean | boolean[] | number | number[] | WebGLTexture | WebGLTexture[];\r\n  loc: WebGLUniformLocation;\r\n  size: number;\r\n  type: number;\r\n}\r\n\r\ninterface ShaderAttribute {\r\n  VBO: VBO;\r\n  loc: GLint;\r\n  size: number;\r\n  type: number;\r\n}\r\n\r\nclass ShaderProgram extends GLResource {\r\n  id: WebGLProgram;\r\n  uCount: number;\r\n  u: ShaderUniform[];\r\n\r\n  aCount: number;\r\n  a: ShaderAttribute[];\r\n\r\n  constructor(gl: WebGLRenderingContext, vertexSource: string, fragmentSource: string) {\r\n    function createShader(type: GLenum, source: string): WebGLShader {\r\n      const shader = gl.createShader(type);\r\n      gl.shaderSource(shader, source);\r\n      gl.compileShader(shader);\r\n\r\n      const success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\r\n      if (!success) {\r\n        console.log(gl.getShaderInfoLog(shader));\r\n        gl.deleteShader(shader);\r\n        return null;\r\n      }\r\n\r\n      return shader;\r\n    }\r\n\r\n    super(gl);\r\n\r\n    this.id = null;\r\n    this.uCount = 0;\r\n    this.aCount = 0;\r\n\r\n    const vertexShader = createShader(gl.VERTEX_SHADER, vertexSource);\r\n    const fragmentShader = createShader(gl.FRAGMENT_SHADER, fragmentSource);\r\n\r\n    const id = gl.createProgram();\r\n    gl.attachShader(id, vertexShader);\r\n    gl.attachShader(id, fragmentShader);\r\n    gl.linkProgram(id);\r\n\r\n    const success = gl.getProgramParameter(id, gl.LINK_STATUS);\r\n    if (!success) {\r\n      console.log(gl.getProgramInfoLog(id));\r\n      gl.deleteProgram(id);\r\n    } else {\r\n      this.id = id;\r\n\r\n      this.introspection();\r\n    }\r\n  }\r\n\r\n  public freeGLResources(): void {\r\n    super.gl().deleteProgram(this.id);\r\n    this.id = null;\r\n  }\r\n\r\n  private introspection(): void {\r\n    const gl = super.gl();\r\n\r\n    this.uCount = gl.getProgramParameter(this.id, gl.ACTIVE_UNIFORMS);\r\n    this.u = [];\r\n    for (let i = 0; i < this.uCount; ++i) {\r\n      const uniform = gl.getActiveUniform(this.id, i);\r\n      const name = uniform.name;\r\n\r\n      this.u[name] = {\r\n        value: null,\r\n        loc: gl.getUniformLocation(this.id, name),\r\n        size: uniform.size,\r\n        type: uniform.type,\r\n      };\r\n    }\r\n\r\n    this.aCount = gl.getProgramParameter(this.id, gl.ACTIVE_ATTRIBUTES);\r\n    this.a = [];\r\n    for (let i = 0; i < this.aCount; ++i) {\r\n      const attribute = gl.getActiveAttrib(this.id, i);\r\n      const name = attribute.name;\r\n\r\n      this.a[name] = {\r\n        VBO: null,\r\n        loc: gl.getAttribLocation(this.id, name),\r\n        size: attribute.size,\r\n        type: attribute.type,\r\n      };\r\n    }\r\n  }\r\n\r\n  public use(): void {\r\n    super.gl().useProgram(this.id);\r\n  }\r\n\r\n  public bindUniforms(): void {\r\n    const gl: WebGLRenderingContext = super.gl();\r\n    let currTextureUnitNb: number = 0;\r\n\r\n    for (let uName in this.u) {\r\n      const uniform = this.u[uName];\r\n      if (uniform.value !== null) {\r\n        if (uniform.type === 0x8B5E || uniform.type === 0x8B60) {\r\n          const unitNb: number = currTextureUnitNb;\r\n          types[uniform.type].binder(gl, uniform.loc, unitNb, uniform.value);\r\n          currTextureUnitNb++;\r\n        } else {\r\n          types[uniform.type].binder(gl, uniform.loc, uniform.value);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public bindAttributes(): void {\r\n    for (let aName in this.a) {\r\n      const attribute = this.a[aName];\r\n      if (attribute.VBO !== null) {\r\n        attribute.VBO.bind(attribute.loc);\r\n      }\r\n    }\r\n  }\r\n\r\n  public bindUniformsAndAttributes(): void {\r\n    this.bindUniforms();\r\n    this.bindAttributes();\r\n  }\r\n}\r\n\r\nexport default ShaderProgram;","function resizeCanvas(gl: WebGLRenderingContext, hidpi: boolean = false): void {\r\n    const cssPixel: number = (hidpi) ? window.devicePixelRatio : 1;\r\n    const canvas = gl.canvas as HTMLCanvasElement;\r\n\r\n    const width: number = Math.floor(canvas.clientWidth * cssPixel);\r\n    const height: number = Math.floor(canvas.clientHeight * cssPixel);\r\n    if (canvas.width != width || canvas.height != height) {\r\n        canvas.width = width;\r\n        canvas.height = height;\r\n    }\r\n}\r\n\r\nexport { resizeCanvas };","import GLResource from \"./gl-resource\";\r\n\r\nclass VBO extends GLResource {\r\n  private id: WebGLBuffer;\r\n  private size: number;\r\n  private type: GLenum;\r\n  private normalize: GLboolean;\r\n  private stride: GLsizei;\r\n  private offset: GLintptr;\r\n\r\n  constructor(gl: WebGLRenderingContext, array: any, size: number, type: GLenum) {\r\n    super(gl);\r\n\r\n    this.id = gl.createBuffer();\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.id);\r\n    gl.bufferData(gl.ARRAY_BUFFER, array, gl.STATIC_DRAW);\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n\r\n    this.size = size;\r\n    this.type = type;\r\n    this.normalize = false;\r\n    this.stride = 0;\r\n    this.offset = 0;\r\n  }\r\n\r\n  public freeGLResources(): void {\r\n    this.gl().deleteBuffer(this.id);\r\n    this.id = null;\r\n  }\r\n\r\n  public static createQuad(gl: WebGLRenderingContext, minX: number, minY: number, maxX: number, maxY: number): VBO {\r\n    let vert = [\r\n      minX, minY,\r\n      maxX, minY,\r\n      minX, maxY,\r\n      maxX, maxY,\r\n    ];\r\n\r\n    return new VBO(gl, new Float32Array(vert), 2, gl.FLOAT);\r\n  }\r\n\r\n  public bind(location: GLuint): void {\r\n    const gl = super.gl();\r\n\r\n    gl.enableVertexAttribArray(location);\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.id);\r\n    gl.vertexAttribPointer(location, this.size, this.type, this.normalize, this.stride, this.offset);\r\n  }\r\n};\r\n\r\nexport default VBO;","class Viewport {\r\n    public lower: number;\r\n    public left: number;\r\n    public width: number;\r\n    public height: number;\r\n}\r\n\r\nexport default Viewport;","import * as Utils from \"./gl-utils/utils\";\r\nimport FBO from \"./gl-utils/fbo\";\r\nimport Water from \"./water\";\r\nimport Viewer from \"./viewer/viewer\";\r\nimport Viewer2D from \"./viewer/viewer2D\";\r\nimport Viewer3D from \"./viewer/viewer3D\";\r\nimport ViewerCommon from \"./viewer/viewerCommon\";\r\nimport * as Controls from \"./controls\";\r\n\r\nimport \"./page-interface-generated\";\r\n\r\n/** Initializes a WebGL context */\r\nfunction initGL(canvas: HTMLCanvasElement, flags: any): WebGLRenderingContext {\r\n    function setError(message: string) {\r\n        Page.Demopage.setErrorMessage(\"webgl-support\", message);\r\n    }\r\n\r\n    let gl: WebGLRenderingContext = canvas.getContext(\"webgl\", flags) as WebGLRenderingContext;\r\n    if (!gl) {\r\n        gl = canvas.getContext(\"experimental-webgl\", flags) as WebGLRenderingContext;\r\n        if (!gl) {\r\n            setError(\"Your browser or device does not seem to support WebGL.\");\r\n            return null;\r\n        }\r\n        setError(\"Your browser or device only supports experimental WebGL.\\n\" +\r\n            \"The simulation may not run as expected.\");\r\n    }\r\n\r\n    gl.disable(gl.CULL_FACE);\r\n    gl.disable(gl.DEPTH_TEST);\r\n    gl.disable(gl.BLEND);\r\n    gl.clearColor(0, 0, 0, 0);\r\n\r\n    Utils.resizeCanvas(gl, false);\r\n\r\n    return gl;\r\n}\r\n\r\nfunction main() {\r\n    const canvas: HTMLCanvasElement = Page.Canvas.getCanvas();\r\n    const gl: WebGLRenderingContext = initGL(canvas, {});\r\n    if (!gl)\r\n        return;\r\n\r\n    const toggleFullscreen = (fullscreen: boolean) => {\r\n        Page.Canvas.getCanvasContainer().style.background = fullscreen ? \"black\" : \"none\";\r\n    };\r\n    Page.Canvas.Observers.fullscreenToggle.push(toggleFullscreen);\r\n    toggleFullscreen(Page.Canvas.isFullScreen());\r\n    \r\n    const side = 512;\r\n    const water: Water = new Water(gl, side, side);\r\n    const viewerCommon: ViewerCommon = new ViewerCommon(gl, 512, \"rc/tile.png\");\r\n    const viewer2D: Viewer2D = new Viewer2D(gl, viewerCommon);\r\n    const viewer3D: Viewer3D = new Viewer3D(gl, viewerCommon);\r\n\r\n    Controls.bind(water, viewer2D, viewer3D);\r\n\r\n    let viewer: Viewer = viewer3D;\r\n    Controls.bindRendererChooser(\r\n        () => { viewer = viewer2D; },\r\n        () => { viewer = viewer3D; });\r\n\r\n    /* Update the FPS indicator every second. */\r\n    let instantFPS: number = 0;\r\n    const updateFpsText = function () {\r\n        Page.Canvas.setIndicatorText(\"fps\", instantFPS.toFixed(0));\r\n    };\r\n    setInterval(updateFpsText, 1000);\r\n\r\n    let lastUpdate = 0;\r\n    function mainLoop(time) {\r\n        time *= 0.001; //dt is now in seconds\r\n        let dt = time - lastUpdate;\r\n        instantFPS = 1 / dt;\r\n        lastUpdate = time;\r\n\r\n        /* Updating */\r\n        viewer.interact(water);\r\n        water.update(1 / 60);\r\n\r\n        Utils.resizeCanvas(gl, false);\r\n        \r\n        /* Drawing */\r\n        if (viewer.caustics) {\r\n            viewerCommon.caustics.compute(water, viewer.amplitude, viewer.waterLevel, viewer.eta);\r\n        }\r\n\r\n        FBO.bindDefault(gl);\r\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n        viewer.display(water, viewerCommon);\r\n\r\n        requestAnimationFrame(mainLoop);\r\n    }\r\n\r\n    requestAnimationFrame(mainLoop);\r\n}\r\n\r\nmain();\r\n","declare const mat4: any;\r\n\r\nclass OrbitalCamera {\r\n    private _focus: number[];\r\n    private _distance: number;\r\n    private _theta: number;\r\n    private _phi: number;\r\n\r\n    private _eyePos: number[];\r\n    private _viewMatrix: number[];\r\n\r\n    constructor(focusPoint: number[], distance: number) {\r\n        this._focus = focusPoint;\r\n        this._distance = distance;\r\n        this._theta = 0;\r\n        this._phi = 0.01;\r\n\r\n        this._eyePos = [0, 0, 0];\r\n        this._viewMatrix = mat4.create();\r\n        this.recompute();\r\n    }\r\n\r\n    public get focusPoint(): number[] {\r\n        return this._focus;\r\n    }\r\n\r\n    public get distance(): number {\r\n        return this._distance;\r\n    }\r\n\r\n    public get theta(): number {\r\n        return this._theta;\r\n    }\r\n\r\n    public get phi(): number {\r\n        return this._phi;\r\n    }\r\n\r\n    public set focusPoint(newFocus: number[]) {\r\n        this._focus = newFocus;\r\n        this.recompute();\r\n    }\r\n\r\n    public set distance(newDistance: number) {\r\n        this._distance = newDistance;\r\n        this.recompute();\r\n    }\r\n\r\n    public set theta(newTheta: number) {\r\n        this._theta = newTheta;\r\n        this.recompute();\r\n    }\r\n\r\n    public set phi(newPhi: number) {\r\n        this._phi = newPhi;\r\n        this.recompute();\r\n    }\r\n\r\n    public get eyePos(): number[] {\r\n        return this._eyePos;\r\n    }\r\n\r\n    public get viewMatrix(): number[] {\r\n        return this._viewMatrix;\r\n    }\r\n\r\n    private recompute(): void {\r\n        const sin = Math.sin;\r\n        const cos = Math.cos;\r\n\r\n        this._eyePos[0] = this.focusPoint[0] + this.distance * (sin(this.phi) * cos(this.theta));\r\n        this._eyePos[1] = this.focusPoint[1] + this.distance * (sin(this.phi) * sin(this.theta));\r\n        this._eyePos[2] = this.focusPoint[2] + this.distance * (cos(this.phi));\r\n\r\n        this._viewMatrix = mat4.lookAt(this._viewMatrix, this.eyePos, this.focusPoint, [0, 0, 1]);\r\n    }\r\n}\r\n\r\nexport default OrbitalCamera;","import Shader from \"../gl-utils/shader\";\r\nimport VBO from \"../gl-utils/vbo\";\r\nimport { encodeDecodeStr } from \"../water-shaders\";\r\n\r\nconst causticsVert: string =\r\n    `attribute vec2 aVert;\r\n\r\nuniform sampler2D uWater;\r\nuniform sampler2D uNormals;\r\n\r\nuniform float uAmplitude;\r\nuniform float uWaterLevel;\r\nuniform float uEta;\r\n\r\nvarying vec2 sourceCoords;\r\nvarying vec2 refractedCoords;\r\n\r\n___ENCODE_DECODE___\r\n\r\nvoid main(void) {\r\n    float height = decodeHeight(texture2D(uWater, aVert));\r\n    height = uWaterLevel + 0.5 * uAmplitude * height;\r\n    vec3 normal = decodeNormal(texture2D(uNormals, aVert), uAmplitude);\r\n\r\n    const vec3 fromLight = vec3(0, 0, -1);\r\n    vec3 refracted = refract(fromLight, normal, uEta);\r\n    vec3 toGround = height * refracted / refracted.z;\r\n\r\n    vec2 groundCoords = aVert + toGround.xy;\r\n\r\n    sourceCoords = aVert;\r\n    refractedCoords = groundCoords;\r\n\r\n    gl_Position = vec4(2.0*groundCoords - 1.0, 0.0, 1.0);\r\n}`;\r\n\r\nconst causticsFrag: string =\r\n    `#extension GL_OES_standard_derivatives : enable\r\nprecision mediump float;\r\n\r\nvarying vec2 sourceCoords;\r\nvarying vec2 refractedCoords;\r\n\r\nvoid main(void)\r\n{\r\n    float sourceArea = length(dFdx(sourceCoords)) * length(dFdy(sourceCoords));\r\n    float refractedArea = length(dFdx(refractedCoords)) * length(dFdy(refractedCoords));\r\n\r\n    float variation = sourceArea / refractedArea;\r\n\r\n    gl_FragColor = 0.5 + .9 * vec4(variation - 1.0);\r\n}`;\r\n\r\nfunction buildCausticsShader(gl: WebGLRenderingContext): Shader {\r\n    const vertSrc = causticsVert.replace(/___ENCODE_DECODE___/g, encodeDecodeStr);;\r\n    const fragSrc = causticsFrag;\r\n\r\n    return new Shader(gl, vertSrc, fragSrc);\r\n}\r\n\r\nexport {\r\n    buildCausticsShader,\r\n};","import GLResource from \"../gl-utils/gl-resource\";\r\nimport FBO from \"../gl-utils/fbo\";\r\nimport Water from \"../water\";\r\nimport Shader from \"../gl-utils/shader\";\r\nimport * as ShadersBuilder from \"./caustics-shaders\";\r\n\r\nclass Caustics extends GLResource {\r\n    private _width: number;\r\n    private _height: number;\r\n\r\n    private _supported: boolean;\r\n\r\n    private _gridWidth: number;\r\n    private _gridHeight: number;\r\n\r\n    private _shader: Shader;\r\n\r\n    private _texture: WebGLTexture;\r\n    private _fbo: FBO;\r\n\r\n    private _vertices: WebGLBuffer;\r\n    private _indices: WebGLBuffer;\r\n\r\n    constructor(gl: WebGLRenderingContext, w: number, h: number) {\r\n        super(gl);\r\n\r\n        this._supported = gl.getExtension('OES_standard_derivatives') !== null;\r\n\r\n        const n = 128;\r\n        this._gridWidth = n;\r\n        this._gridHeight = n;\r\n\r\n        this.reset(w, h);\r\n    }\r\n\r\n    public freeGLResources(): void {\r\n        const gl = super.gl(); //shortcut\r\n\r\n        if (this._shader) {\r\n            this._shader.freeGLResources();\r\n        }\r\n        if (this._texture) {\r\n            gl.deleteTexture(this._texture);\r\n        }\r\n        if (this._fbo) {\r\n            this._fbo.freeGLResources();\r\n        }\r\n\r\n        if (this._vertices) {\r\n            gl.deleteBuffer(this._vertices);\r\n        }\r\n        if (this._indices) {\r\n            gl.deleteBuffer(this._indices);\r\n        }\r\n    }\r\n\r\n    public compute(water: Water, amplitude: number, waterLevel: number, eta: number): void {\r\n        if (!this.supported)\r\n            return;\r\n\r\n        const gl = super.gl(); //shortcut\r\n        const shader = this._shader;\r\n\r\n        shader.u[\"uWater\"].value = water.heightmap;\r\n        shader.u[\"uNormals\"].value = water.normalmap;\r\n        shader.u[\"uAmplitude\"].value = 0.1 * amplitude;\r\n        shader.u[\"uWaterLevel\"].value = waterLevel;\r\n        shader.u[\"uEta\"].value = eta;\r\n\r\n        this._fbo.bind([this._texture]);\r\n        gl.clear(gl.COLOR_BUFFER_BIT);\r\n\r\n        shader.use();\r\n        shader.bindUniforms();//AndAttributes();\r\n\r\n        gl.enableVertexAttribArray(0);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._vertices);\r\n        gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._indices);\r\n\r\n        const nbTriangles = 2 * (this._gridWidth - 1) * (this._gridHeight - 1);\r\n        gl.drawElements(gl.TRIANGLES, 3 * nbTriangles, gl.UNSIGNED_SHORT, 0);\r\n\r\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n        gl.disableVertexAttribArray(0);\r\n    }\r\n\r\n    public reset(w: number, h: number): void {\r\n        if (!this.supported)\r\n            return;\r\n\r\n        this.freeGLResources();\r\n\r\n        const gl = super.gl(); //shortcut\r\n\r\n        this._width = w;\r\n        this._height = h;\r\n\r\n        this._shader = ShadersBuilder.buildCausticsShader(gl);\r\n\r\n        this._fbo = new FBO(gl, w, h);\r\n\r\n        /* Texture initialization */\r\n        const data: number[] = new Array(3 * w * h);\r\n        for (let i = 0; i < data.length;  ++i) {\r\n            data[i] = 127;\r\n        }\r\n        const uintData = new Uint8Array(data);\r\n\r\n        const wrap = gl.CLAMP_TO_EDGE;\r\n        const filter = gl.LINEAR;\r\n        this._texture = gl.createTexture();\r\n        gl.bindTexture(gl.TEXTURE_2D, this._texture);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGB, w, h, 0,\r\n            gl.RGB, gl.UNSIGNED_BYTE, uintData);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filter);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filter);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, wrap);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, wrap);\r\n\r\n        /* Grid vertices */\r\n        {\r\n            const nX = this._gridWidth;\r\n            const nY = this._gridHeight;\r\n            {\r\n                const vert = [];\r\n                for (let iY = 0; iY < nY; ++iY) {\r\n                    for (let iX = 0; iX < nX; ++iX) {\r\n                        vert.push(iX / (nX - 1));\r\n                        vert.push(iY / (nY - 1));\r\n                    }\r\n                }\r\n                const array = new Float32Array(vert);\r\n\r\n                const id = gl.createBuffer();\r\n                gl.bindBuffer(gl.ARRAY_BUFFER, id);\r\n                gl.bufferData(gl.ARRAY_BUFFER, array, gl.STATIC_DRAW);\r\n                gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n                this._vertices = id;\r\n            }\r\n            {\r\n                const indices = [];\r\n                for (let iY = 0; iY < nY - 1; ++iY) {\r\n                    for (let iX = 0; iX < nX - 1; ++iX) {\r\n                        indices.push(iY * nX + iX);\r\n                        indices.push(iY * nX + iX + 1);\r\n                        indices.push((iY + 1) * nX + iX);\r\n\r\n                        indices.push(iY * nX + iX + 1);\r\n                        indices.push((iY + 1) * nX + iX + 1);\r\n                        indices.push((iY + 1) * nX + iX);\r\n                    }\r\n                }\r\n\r\n                const array = new Uint16Array(indices);\r\n\r\n                const id = gl.createBuffer();\r\n                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, id);\r\n                gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, array, gl.STATIC_DRAW);\r\n                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\r\n                this._indices = id;\r\n            }\r\n        }\r\n    }\r\n\r\n    get width(): number {\r\n        return this._width;\r\n    }\r\n    get height(): number {\r\n        return this._height;\r\n    }\r\n\r\n    get texture(): WebGLTexture {\r\n        return this._texture;\r\n    }\r\n\r\n    get supported(): boolean {\r\n        return this._supported;\r\n    }\r\n}\r\n\r\nexport default Caustics;","import GLResource from \"../gl-utils/gl-resource\";\r\nimport Water from \"../water\";\r\nimport ViewerCommon from \"./viewerCommon\";\r\n\r\nabstract class Viewer extends GLResource {\r\n    private _showSpecular: boolean;\r\n    private _showCaustics: boolean;\r\n    private _useFresnel: boolean;\r\n    private _amplitude: number;\r\n    private _waterLevel: number;\r\n    private _opacity: number;\r\n    private _eta: number;\r\n\r\n    constructor(gl: WebGLRenderingContext) {\r\n        super(gl);\r\n    }\r\n\r\n    public freeGLResources(): void {\r\n    }\r\n\r\n    public abstract display(water: Water, common: ViewerCommon): void;\r\n\r\n    public abstract interact(water: Water): void;\r\n\r\n    protected abstract updateSpecular(): void;\r\n    protected abstract updateCaustics(): void;\r\n    protected abstract updateFresnel(): void;\r\n    protected abstract updateAmplitude(): void;\r\n    protected abstract updateWaterLevel(): void;\r\n    protected abstract updateOpacity(): void;\r\n    protected abstract updateEta(): void;\r\n\r\n    set specular(b: boolean) {\r\n        this._showSpecular = b;\r\n        this.updateSpecular();\r\n    }\r\n    get specular(): boolean {\r\n        return this._showSpecular;\r\n    }\r\n\r\n    set caustics(b: boolean) {\r\n        this._showCaustics = b;\r\n        this.updateCaustics();\r\n    }\r\n    get caustics(): boolean {\r\n        return this._showCaustics;\r\n    }\r\n\r\n    set fresnel(b: boolean) {\r\n        this._useFresnel = b;\r\n        this.updateFresnel();\r\n    }\r\n    get fresnel(): boolean {\r\n        return this._useFresnel;\r\n    }\r\n\r\n    set amplitude(a: number) {\r\n        this._amplitude = a;\r\n        this.updateAmplitude();\r\n    }\r\n    get amplitude(): number {\r\n        return this._amplitude;\r\n    }\r\n\r\n    set waterLevel(d: number) {\r\n        this._waterLevel = d;\r\n        this.updateWaterLevel();\r\n    }\r\n    get waterLevel(): number {\r\n        return this._waterLevel;\r\n    }\r\n\r\n    set opacity(o: number) {\r\n        this._opacity = o;\r\n        this.updateOpacity();\r\n    }\r\n    get opacity(): number {\r\n        return this._opacity;\r\n    }\r\n\r\n    set eta(e: number) {\r\n        this._eta = e;\r\n        this.updateEta();\r\n    }\r\n    get eta(): number {\r\n        return this._eta;\r\n    }\r\n}\r\n\r\nexport default Viewer;","import Shader from \"../gl-utils/shader\";\r\nimport VBO from \"../gl-utils/vbo\";\r\nimport { encodeDecodeStr } from \"../water-shaders\";\r\n\r\nconst fullscreenVert: string =\r\n    `attribute vec2 aCorner; //{0,1}x{0,1}\r\n\r\nvarying vec2 sampleCoords;\r\n\r\nvoid main(void) {\r\n    sampleCoords = aCorner;\r\n    gl_Position = vec4(2.0*aCorner - 1.0, 0.0, 1.0);\r\n}`;\r\n\r\nconst displayFrag: string =\r\n    `precision mediump float;\r\n\r\nuniform sampler2D uWater;\r\nuniform sampler2D uNormals;\r\nuniform sampler2D uCaustics;\r\nuniform sampler2D uTileTexture;\r\n\r\nuniform float uWaterLevel;\r\nuniform float uAmplitude;\r\nuniform float uEta;\r\nuniform float uOpacity;\r\nuniform bool uShowSpecular;\r\nuniform bool uShowCaustics;\r\n\r\nvarying vec2 sampleCoords;\r\n\r\n___ENCODE_DECODE___\r\n\r\nconst vec3 WATER_COLOR = vec3(0.0, 0.2, 0.5);\r\nconst vec3 SPECULAR_COLOR = vec3(1);\r\nconst float TILE_REPETITION = 4.0;\r\n\r\nvoid main(void)\r\n{\r\n    float height = decodeHeight(texture2D(uWater, sampleCoords));\r\n    height = uWaterLevel + 0.5 * uAmplitude * height;\r\n    vec3 normal = decodeNormal(texture2D(uNormals, sampleCoords), uAmplitude);\r\n\r\n    vec3 position = vec3(sampleCoords, height);\r\n\r\n    const vec3 fromEye = vec3(0, 0, -1);\r\n    vec3 refracted = refract(fromEye, normal, uEta);\r\n    refracted *= height / refracted.z;\r\n    vec2 coordsOnFloor = sampleCoords + refracted.xy;\r\n\r\n    vec3 tileColor = texture2D(uTileTexture, TILE_REPETITION * coordsOnFloor).rgb;\r\n    float caustics = texture2D(uCaustics, coordsOnFloor).r;\r\n    caustics = mix(0.5, caustics, float(uShowCaustics));\r\n    vec3 floorColor = tileColor * (0.5 + caustics);\r\n\r\n    float opacity = clamp(uOpacity * length(refracted), 0.0, 1.0);\r\n    vec3 color = mix(floorColor, WATER_COLOR, opacity);\r\n\r\n    // const vec3 fromLight = normalize(vec3(.05, -.1, -.8));\r\n    const vec3 fromLight = vec3(-.061898, -.123797, -.990405); // precomputed for IE11\r\n    vec3 reflected = reflect(fromLight, normal);\r\n    float specular = max(0.0, dot(reflected, -fromEye));\r\n    specular = pow(specular, 1000.0) * float(uShowSpecular);\r\n\r\n    gl_FragColor = vec4(color + specular, 1);\r\n}`;\r\n\r\nfunction buildDisplayShader(gl: WebGLRenderingContext): Shader {\r\n    const vertSrc: string = fullscreenVert;\r\n    const fragSrc = displayFrag.replace(/___ENCODE_DECODE___/g, encodeDecodeStr);\r\n\r\n    const shader: Shader = new Shader(gl, vertSrc, fragSrc);\r\n    shader.a[\"aCorner\"].VBO = VBO.createQuad(gl, 0, 0, 1, 1);\r\n    return shader\r\n}\r\n\r\nexport {\r\n    buildDisplayShader,\r\n};","import Viewer from \"./viewer\";\r\nimport ViewerCommon from \"./viewerCommon\";\r\nimport Water from \"../water\";\r\nimport Caustics from \"./caustics\";\r\nimport Shader from \"../gl-utils/shader\";\r\nimport FBO from \"../gl-utils/fbo\";\r\nimport Viewport from \"../gl-utils/viewport\";\r\nimport * as ShadersBuilder from \"./viewer2D-shaders\";\r\n\r\nimport \"../page-interface-generated\";\r\n\r\nclass Viewer2D extends Viewer {\r\n    private _displayShader: Shader;\r\n    private _viewport: Viewport;\r\n\r\n    constructor(gl: WebGLRenderingContext, common: ViewerCommon) {\r\n        super(gl);\r\n        \r\n        this._displayShader = ShadersBuilder.buildDisplayShader(gl);\r\n        this._displayShader.u[\"uTileTexture\"].value = common.tileTexture;\r\n        this._displayShader.u[\"uCaustics\"].value = common.caustics.texture;\r\n\r\n        this._viewport = new Viewport;\r\n    }\r\n\r\n    public freeGLResources(): void {\r\n        this._displayShader.freeGLResources();\r\n    }\r\n\r\n    private updateViewport(): void {\r\n        const gl = super.gl();\r\n        const side = Math.min(gl.drawingBufferWidth, gl.drawingBufferHeight);\r\n        \r\n        this._viewport.left = 0.5 * (gl.drawingBufferWidth - side);\r\n        this._viewport.lower = 0.5 * (gl.drawingBufferHeight - side);\r\n        this._viewport.width = side;\r\n        this._viewport.height = side;\r\n    }\r\n\r\n    public display(water: Water, common: ViewerCommon): void {\r\n        const gl = super.gl(); //shortcut\r\n\r\n        this.updateViewport();\r\n\r\n        gl.disable(gl.CULL_FACE);\r\n        gl.disable(gl.DEPTH_TEST);\r\n\r\n        const displayShader = this._displayShader;\r\n\r\n        FBO.bindDefault(gl, this._viewport);\r\n\r\n        displayShader.u[\"uWater\"].value = water.heightmap;\r\n        displayShader.u[\"uNormals\"].value = water.normalmap;\r\n\r\n        displayShader.use();\r\n        displayShader.bindUniformsAndAttributes();\r\n\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n    }\r\n\r\n    public interact(water: Water): void {\r\n        if (Page.Canvas.isMouseDown()) {\r\n            const canvasSize = Page.Canvas.getSize();\r\n            const p = Page.Canvas.getMousePosition(); // normalized\r\n            p[0] *= canvasSize[0]; //in pixels\r\n            p[1] = (1 - p[1]) * canvasSize[1]; //in pixels\r\n\r\n            this.updateViewport();\r\n            p[0] = (p[0] - this._viewport.left) / this._viewport.width;\r\n            p[1] = (p[1] - this._viewport.lower) / this._viewport.height;\r\n\r\n            water.touch(p[0] * water.width, p[1] * water.height, 8);\r\n        }\r\n    }\r\n\r\n    protected updateSpecular(): void {\r\n        this._displayShader.u[\"uShowSpecular\"].value = this.specular;\r\n    }\r\n\r\n    protected updateCaustics(): void {\r\n        this._displayShader.u[\"uShowCaustics\"].value = this.caustics;\r\n    }\r\n\r\n    protected updateFresnel(): void {\r\n    }\r\n\r\n    protected updateAmplitude(): void {\r\n        this._displayShader.u[\"uAmplitude\"].value = this.amplitude;\r\n    }\r\n\r\n    protected updateWaterLevel(): void {\r\n        this._displayShader.u[\"uWaterLevel\"].value = this.waterLevel;\r\n    }\r\n\r\n    protected updateOpacity(): void {\r\n        this._displayShader.u[\"uOpacity\"].value = this.opacity;\r\n    }\r\n    \r\n    protected updateEta(): void {\r\n        this._displayShader.u[\"uEta\"].value = this.eta;\r\n    }\r\n}\r\n\r\nexport default Viewer2D;","import Shader from \"../gl-utils/shader\";\r\nimport { encodeDecodeStr } from \"../water-shaders\";\r\n\r\nconst waterCommonStr: string =\r\n    `\r\nuniform sampler2D uCaustics;\r\nuniform sampler2D uTileTexture;\r\n\r\nuniform vec3 uLightDir; //normalized\r\n\r\nuniform float uF0;\r\nuniform float uEta;\r\nuniform float uOpacity;\r\nuniform bool uSpecular;\r\nuniform bool uShowCaustics;\r\nuniform bool uFresnel;\r\n\r\nconst vec3 WATER_COLOR = vec3(0.0, 0.2, 0.5);\r\nconst vec3 SPECULAR_COLOR = vec3(1);\r\nconst float TILE_REPETITION = 4.0;\r\n\r\n/* Fresnel factor describes the proportion of refracted and reflected.\r\n* Arguments expected to be normalized. */\r\nfloat getFresnelFactor(const vec3 normal, const vec3 fromEye)\r\n{\r\n    float computed = mix(pow(1.0 - dot(normal,-fromEye), 5.0), 1.0, uF0);\r\n    return min(float(uFresnel), computed);\r\n}\r\n\r\nvec3 getTileColor(const vec2 coords)\r\n{\r\n    return texture2D(uTileTexture, TILE_REPETITION * coords).rgb;\r\n}\r\n\r\nfloat getCaustics(const vec2 coords)\r\n{\r\n    return mix(0.5, texture2D(uCaustics, coords).r, float(uShowCaustics));\r\n}\r\n\r\nvec3 getFloorColor(const vec2 coords)\r\n{\r\n    if (any(lessThan(coords, vec2(0))) || any(greaterThan(coords, vec2(1)))) {\r\n        return vec3(0);\r\n    }\r\n\r\n    return getTileColor(coords) * (0.5 + getCaustics(coords));\r\n}\r\n\r\n/* Floor color mixed with opacity.\r\n* 'refracted' expected to be normalized. */\r\nvec3 getRefractedColor(const vec3 entryPoint, vec3 refracted)\r\n{\r\n    if (refracted.z >= 0.0) {\r\n        return WATER_COLOR;\r\n    }\r\n\r\n    refracted *= -entryPoint.z / refracted.z;\r\n\r\n    vec2 groundCoords = entryPoint.xy + refracted.xy;\r\n    vec3 floorColor = getFloorColor(groundCoords + .5);\r\n\r\n    /*float f = 1.0;\r\n\r\n    if (groundCoords.x < -.5) {\r\n        f = min(f, abs((-.5 - entryPoint.x) / (groundCoords.x - entryPoint.x)));\r\n    }\r\n    if (groundCoords.x > .5) {\r\n        f = min(f, abs((.5 - entryPoint.x) / (groundCoords.x - entryPoint.x)));\r\n    }\r\n    if (groundCoords.y < -.5) {\r\n        f = min(f, abs((-.5 - entryPoint.y) / (groundCoords.y - entryPoint.y)));\r\n    }\r\n    if (groundCoords.y > .5) {\r\n        f = min(f, abs((.5 - entryPoint.y) / (groundCoords.y - entryPoint.y)));\r\n    }\r\n\r\n    refracted *= f;*/\r\n\r\n    float opacity = uOpacity * entryPoint.z;//length(refracted);\r\n    opacity = clamp(opacity, 0.0, 1.0);\r\n\r\n    return mix(floorColor, WATER_COLOR, opacity);\r\n}\r\n\r\nvec3 getReflectedColor(const vec3 dir)\r\n{\r\n    return vec3(0.5, 0.5, 0.8);\r\n}\r\n\r\nvec4 getSpecular(const vec3 reflected)\r\n{\r\n    float f = max(0.0, dot(-uLightDir, reflected));\r\n    f = pow(f, 200.0);\r\n    f *= float(uSpecular);\r\n\r\n    return vec4(SPECULAR_COLOR, f);\r\n}\r\n\r\nvec3 computeColor(const vec3 pos, const vec3 fromEye, const vec3 normal)\r\n{\r\n    vec3 refracted = refract(fromEye, normal, uEta);\r\n    vec3 reflected = reflect(fromEye, normal);\r\n\r\n    vec3 refractedColor = getRefractedColor(pos, refracted);\r\n    vec3 reflectedColor = getReflectedColor(reflected);\r\n\r\n    float fresnelFactor = getFresnelFactor(fromEye, normal);\r\n\r\n    vec3 surfaceColor = mix(refractedColor, reflectedColor, fresnelFactor);\r\n    vec4 specularColor = getSpecular(reflected);\r\n\r\n    return mix(surfaceColor, specularColor.rgb, specularColor.a);\r\n}`;\r\n\r\nconst sidesVert: string =\r\n    `attribute vec3 aPosition; //in {-.5, +.5} x {-.5, +.5} x {+0, +1}\r\nattribute vec2 aNormal; //normalized in {-1, +1} x {-1, +1}\r\n\r\nuniform mat4 uMVPMatrix;\r\n\r\nuniform float uWaterLevel;\r\nuniform float uAmplitude;\r\n\r\nvarying vec3 vPosition;\r\nvarying vec2 vNormal;\r\nvarying float relativeHeight; //relative to amplitude, in [-1, +1]\r\n\r\nvoid main(void) {\r\n    float dH = uAmplitude / 2.0;\r\n\r\n    vPosition = aPosition;\r\n    vPosition.z *= uWaterLevel + dH;\r\n\r\n    vNormal = aNormal;\r\n\r\n    relativeHeight = (vPosition.z - uWaterLevel) / dH;\r\n    \r\n    gl_Position = uMVPMatrix * vec4(vPosition, 1.0);\r\n}`;\r\n\r\nconst sidesFrag: string =\r\n    `precision mediump float;\r\n\r\nuniform sampler2D uWater;\r\n\r\nuniform vec3 uEyePos;\r\n\r\nvarying vec3 vPosition;\r\nvarying vec2 vNormal;\r\nvarying float relativeHeight; //relative to amplitude, in [-1, +1]\r\n\r\n___ENCODE_DECODE___\r\n\r\n___WATER_COMMON___\r\n\r\n/* Returns true for every fragment above the water level */\r\nbool shouldSkip()\r\n{\r\n    float surface = decodeHeight(texture2D(uWater, vPosition.xy + .5));\r\n    return (relativeHeight > surface);\r\n}\r\n\r\nvoid main(void)\r\n{\r\n    /* Skip the fragments above water level */\r\n    if (shouldSkip()) {\r\n        discard;\r\n    }\r\n\r\n    vec3 fromEye = normalize(vPosition - uEyePos);\r\n    vec3 normal = vec3(vNormal, 0); //already normalized\r\n    \r\n    vec3 color = computeColor(vPosition, fromEye, normal);\r\n\r\n    gl_FragColor = vec4(color, 1);\r\n}`;\r\n\r\nconst surfaceVert: string =\r\n    `attribute vec2 aSampleCoords; //in [0,1] x [0,1]\r\n\r\nuniform mat4 uMVPMatrix;\r\n\r\nuniform sampler2D uWater;\r\nuniform sampler2D uNormals;\r\n\r\nuniform float uWaterLevel;\r\nuniform float uAmplitude;\r\n\r\nvarying vec3 vPosition;\r\nvarying vec3 vNormal;\r\n\r\n___ENCODE_DECODE___\r\n\r\nvoid main(void) {\r\n    float height = decodeHeight(texture2D(uWater, aSampleCoords));\r\n\r\n    float dH = uAmplitude / 2.0;\r\n\r\n    vPosition.xy = aSampleCoords - .5;\r\n    vPosition.z = uWaterLevel + dH * height;\r\n    vPosition.z -= 0.001; //slight shift to avoid artifacts at surface-sides jointure\r\n\r\n    vNormal = decodeNormal(texture2D(uNormals, aSampleCoords), uAmplitude);\r\n    \r\n    gl_Position = uMVPMatrix * vec4(vPosition, 1.0);\r\n}`;\r\n\r\nconst surfaceFrag: string =\r\n    `precision mediump float;\r\n\r\nuniform vec3 uEyePos;\r\n\r\nvarying vec3 vPosition;\r\nvarying vec3 vNormal;\r\n\r\n___WATER_COMMON___\r\n\r\nvoid main(void)\r\n{\r\n    vec3 fromEye = normalize(vPosition - uEyePos);\r\n    vec3 normal = normalize(vNormal);\r\n\r\n    vec3 color = computeColor(vPosition, fromEye, normal);\r\n\r\n    gl_FragColor = vec4(color, 1);\r\n}`;\r\n\r\nfunction buildSidesShader(gl: WebGLRenderingContext): Shader {\r\n    const vertSrc = sidesVert;\r\n    let fragSrc = sidesFrag.replace(/___ENCODE_DECODE___/g, encodeDecodeStr);\r\n    fragSrc = fragSrc.replace(/___WATER_COMMON___/g, waterCommonStr);\r\n\r\n    return new Shader(gl, vertSrc, fragSrc);\r\n}\r\n\r\nfunction buildSurfaceShader(gl: WebGLRenderingContext): Shader {\r\n    const vertSrc = surfaceVert.replace(/___ENCODE_DECODE___/g, encodeDecodeStr);\r\n    let fragSrc = surfaceFrag.replace(/___WATER_COMMON___/g, waterCommonStr);\r\n\r\n    return new Shader(gl, vertSrc, fragSrc);\r\n}\r\n\r\nexport {\r\n    buildSidesShader,\r\n    buildSurfaceShader,\r\n};","import Viewer from \"./viewer\";\r\nimport ViewerCommon from \"./viewerCommon\";\r\nimport Water from \"../water\";\r\nimport Caustics from \"./caustics\";\r\nimport Shader from \"../gl-utils/shader\";\r\nimport FBO from \"../gl-utils/fbo\";\r\nimport * as ShadersBuilder from \"./viewer3D-shaders\";\r\nimport OrbitalCamera from \"../orbitalCamera\";\r\n\r\nimport \"../page-interface-generated\";\r\n\r\ndeclare const mat4: any;\r\ndeclare const vec3: any;\r\n\r\nclass Viewer3D extends Viewer {\r\n    private _vertices: WebGLBuffer;\r\n    private _normals: WebGLBuffer;\r\n\r\n    private _pMatrix: number[];\r\n    private _mvpMatrix: number[];\r\n    private _camera: OrbitalCamera;\r\n    private _lightDirection: number[];\r\n\r\n    private _sidesShader: Shader;\r\n    private _surfaceShader: Shader;\r\n\r\n    private _gridWidth: number;\r\n    private _gridHeight: number;\r\n\r\n    private _gridVertices: WebGLBuffer;\r\n    private _gridIndices: WebGLBuffer;\r\n\r\n    constructor(gl: WebGLRenderingContext, common: ViewerCommon) {\r\n        super(gl);\r\n        const canvas = gl.canvas as HTMLCanvasElement;\r\n\r\n        this._pMatrix = mat4.create();\r\n        this._mvpMatrix = mat4.create();\r\n        mat4.perspective(this._pMatrix, 45, canvas.clientWidth / canvas.clientHeight, 0.1, 100.0);\r\n\r\n        this._camera = new OrbitalCamera([0, 0, this.waterLevel - .5], 1.7);\r\n        this._camera.theta = 0;\r\n        this._camera.phi = 0.8;\r\n\r\n        this._lightDirection = vec3.fromValues(1, 0, -1);\r\n        vec3.normalize(this._lightDirection, this._lightDirection);\r\n\r\n        const n = 256;\r\n        this.initSurface(n, n);\r\n\r\n        this.init();\r\n\r\n        const shaders = [this._sidesShader, this._surfaceShader];\r\n        for (let shader of shaders) {\r\n            shader.u[\"uTileTexture\"].value = common.tileTexture;\r\n            shader.u[\"uCaustics\"].value = common.caustics.texture;\r\n            shader.u[\"uLightDir\"].value = this._lightDirection;\r\n        }\r\n\r\n        const minPhi = 0.000001, maxPhi = 1.2;\r\n        Page.Canvas.Observers.mouseDrag.push((dX: number, dY: number) => {\r\n            this._camera.theta -= 0.5 * 2 * 3.14159 * dX;\r\n            this._camera.phi -= 0.5 * 2 * dY;\r\n            this._camera.phi = Math.min(maxPhi, Math.max(minPhi, this._camera.phi));\r\n            this.updateMVPMatrix();\r\n        });\r\n\r\n        const minDist = 1.42, maxDist = 3;\r\n        Page.Canvas.Observers.mouseWheel.push((delta: number) => {\r\n            let d = this._camera.distance + 0.2 * delta;\r\n            d = Math.min(maxDist, Math.max(minDist, d));\r\n            this._camera.distance = d;\r\n            this.updateMVPMatrix();\r\n        });\r\n    }\r\n\r\n    private updatePMatrix(): void {\r\n      const canvas = super.gl().canvas as HTMLCanvasElement;\r\n        mat4.perspective(this._pMatrix, 45, canvas.clientWidth / canvas.clientHeight, 0.1, 100.0);\r\n    }\r\n\r\n    private updateMVPMatrix(): void {\r\n        this.updatePMatrix();\r\n        mat4.multiply(this._mvpMatrix, this._pMatrix, this._camera.viewMatrix);\r\n    }\r\n\r\n    public initSurface(w: number, h: number): void {\r\n        const gl = super.gl(); //shortcut\r\n\r\n        this._gridWidth = w;\r\n        this._gridHeight = h;\r\n\r\n        /* Grid vertices */\r\n        {\r\n            const nX = this._gridWidth;\r\n            const nY = this._gridHeight;\r\n            {\r\n                const vert = [];\r\n                for (let iY = 0; iY < nY; ++iY) {\r\n                    for (let iX = 0; iX < nX; ++iX) {\r\n                        vert.push(iX / (nX - 1));\r\n                        vert.push(iY / (nY - 1));\r\n                    }\r\n                }\r\n                const array = new Float32Array(vert);\r\n\r\n                const id = gl.createBuffer();\r\n                gl.bindBuffer(gl.ARRAY_BUFFER, id);\r\n                gl.bufferData(gl.ARRAY_BUFFER, array, gl.STATIC_DRAW);\r\n                gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n                this._gridVertices = id;\r\n            }\r\n            {\r\n                const indices = [];\r\n                for (let iY = 0; iY < nY - 1; ++iY) {\r\n                    for (let iX = 0; iX < nX - 1; ++iX) {\r\n                        indices.push(iY * nX + iX);\r\n                        indices.push(iY * nX + iX + 1);\r\n                        indices.push((iY + 1) * nX + iX);\r\n\r\n                        indices.push(iY * nX + iX + 1);\r\n                        indices.push((iY + 1) * nX + iX + 1);\r\n                        indices.push((iY + 1) * nX + iX);\r\n                    }\r\n                }\r\n\r\n                const array = new Uint16Array(indices);\r\n\r\n                const id = gl.createBuffer();\r\n                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, id);\r\n                gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, array, gl.STATIC_DRAW);\r\n                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\r\n                this._gridIndices = id;\r\n            }\r\n        }\r\n    }\r\n\r\n    public freeGLResources(): void {\r\n        const gl = super.gl(); //shortcut\r\n\r\n        gl.deleteBuffer(this._vertices);\r\n        gl.deleteBuffer(this._normals);\r\n        this._sidesShader.freeGLResources();\r\n        this._surfaceShader.freeGLResources();\r\n\r\n        gl.deleteBuffer(this._gridVertices);\r\n        gl.deleteBuffer(this._gridIndices);\r\n    }\r\n\r\n    public display(water: Water, common: ViewerCommon): void {\r\n        const gl = super.gl(); //shortcut\r\n\r\n        /* Update camera position */\r\n        this._sidesShader.u[\"uEyePos\"].value = this._camera.eyePos;\r\n        this._surfaceShader.u[\"uEyePos\"].value = this._camera.eyePos;\r\n\r\n        this.updateMVPMatrix();\r\n\r\n        /* Actual displaying */\r\n        gl.enable(gl.CULL_FACE);\r\n        gl.enable(gl.DEPTH_TEST);\r\n\r\n        this.displaySides(water);\r\n        this.displaySurface(water);\r\n    }\r\n\r\n    public interact(water: Water): void {\r\n    }\r\n\r\n    private displaySides(water: Water): void {\r\n        const gl = super.gl(); //shortcut\r\n        const shader = this._sidesShader;\r\n\r\n        shader.u[\"uWater\"].value = water.heightmap;\r\n\r\n        shader.use();\r\n        shader.bindUniforms();\r\n\r\n        const vLoc = 0;\r\n        const nLoc = 1;\r\n        gl.enableVertexAttribArray(vLoc);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._vertices);\r\n        gl.vertexAttribPointer(vLoc, 3, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.enableVertexAttribArray(nLoc);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._normals);\r\n        gl.vertexAttribPointer(nLoc, 2, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.drawArrays(gl.TRIANGLES, 0, 4 * 6);\r\n\r\n        gl.disableVertexAttribArray(nLoc);\r\n        gl.disableVertexAttribArray(vLoc);\r\n    }\r\n\r\n    private displaySurface(water: Water): void {\r\n        const gl = super.gl(); //shortcut\r\n        const shader = this._surfaceShader;\r\n\r\n        shader.u[\"uWater\"].value = water.heightmap;\r\n        shader.u[\"uNormals\"].value = water.normalmap;\r\n\r\n        shader.use();\r\n        shader.bindUniforms();\r\n\r\n        gl.enableVertexAttribArray(0);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._gridVertices);\r\n        gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._gridIndices);\r\n\r\n        const nbTriangles = 2 * (this._gridWidth - 1) * (this._gridHeight - 1);\r\n        gl.drawElements(gl.TRIANGLES, 3 * nbTriangles, gl.UNSIGNED_SHORT, 0);\r\n\r\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n        gl.disableVertexAttribArray(0);\r\n    }\r\n\r\n    private init() {\r\n        const gl = super.gl(); //shortcut\r\n\r\n        this._sidesShader = ShadersBuilder.buildSidesShader(gl);\r\n        this._sidesShader.u[\"uMVPMatrix\"].value = this._mvpMatrix;\r\n\r\n        this._surfaceShader = ShadersBuilder.buildSurfaceShader(gl);\r\n        this._surfaceShader.u[\"uMVPMatrix\"].value = this._mvpMatrix;\r\n\r\n        /* Buffer data */\r\n        {\r\n            const vert = [\r\n                +.5, -.5, +1,\r\n                -.5, -.5, +1,\r\n                -.5, -.5, +0,\r\n                +.5, -.5, +1,\r\n                -.5, -.5, +0,\r\n                +.5, -.5, +0,\r\n\r\n                +.5, +.5, +1,\r\n                +.5, -.5, +1,\r\n                +.5, -.5, +0,\r\n                +.5, +.5, +1,\r\n                +.5, -.5, +0,\r\n                +.5, +.5, +0,\r\n\r\n                +.5, +.5, +1,\r\n                -.5, +.5, +0,\r\n                -.5, +.5, +1,\r\n                -.5, +.5, +0,\r\n                +.5, +.5, +1,\r\n                +.5, +.5, +0,\r\n\r\n                -.5, -.5, +1,\r\n                -.5, +.5, +1,\r\n                -.5, -.5, +0,\r\n                -.5, -.5, +0,\r\n                -.5, +.5, +1,\r\n                -.5, +.5, +0,];\r\n\r\n            const id = gl.createBuffer();\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, id);\r\n            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vert), gl.STATIC_DRAW);\r\n            this._vertices = id;\r\n        }\r\n\r\n        {\r\n            const norm = [\r\n                0, -1,\r\n                0, -1,\r\n                0, -1,\r\n                0, -1,\r\n                0, -1,\r\n                0, -1,\r\n\r\n                +1, 0,\r\n                +1, 0,\r\n                +1, 0,\r\n                +1, 0,\r\n                +1, 0,\r\n                +1, 0,\r\n\r\n                0, +1,\r\n                0, +1,\r\n                0, +1,\r\n                0, +1,\r\n                0, +1,\r\n                0, +1,\r\n\r\n                -1, 0,\r\n                -1, 0,\r\n                -1, 0,\r\n                -1, 0,\r\n                -1, 0,\r\n                -1, 0,];\r\n\r\n            const id = gl.createBuffer();\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, id);\r\n            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(norm), gl.STATIC_DRAW);\r\n            this._normals = id;\r\n        }\r\n    }\r\n\r\n    protected updateSpecular(): void {\r\n        this._sidesShader.u[\"uSpecular\"].value = this.specular;\r\n        this._surfaceShader.u[\"uSpecular\"].value = this.specular;\r\n    }\r\n\r\n    protected updateCaustics(): void {\r\n        this._sidesShader.u[\"uShowCaustics\"].value = this.caustics;\r\n        this._surfaceShader.u[\"uShowCaustics\"].value = this.caustics;\r\n    }\r\n\r\n    protected updateFresnel(): void {\r\n        this._sidesShader.u[\"uFresnel\"].value = this.fresnel;\r\n        this._surfaceShader.u[\"uFresnel\"].value = this.fresnel;\r\n    }\r\n\r\n    protected updateAmplitude(): void {\r\n        const amplitude = 5 * this.amplitude;\r\n        this._sidesShader.u[\"uAmplitude\"].value = amplitude;\r\n        this._surfaceShader.u[\"uAmplitude\"].value = amplitude;\r\n    }\r\n\r\n    protected updateWaterLevel(): void {\r\n        this._sidesShader.u[\"uWaterLevel\"].value = this.waterLevel;\r\n        this._surfaceShader.u[\"uWaterLevel\"].value = this.waterLevel;\r\n        this._camera.focusPoint = [0, 0, this.waterLevel - .5];\r\n        this.updateMVPMatrix();\r\n    }\r\n\r\n    protected updateOpacity(): void {\r\n        this._sidesShader.u[\"uOpacity\"].value = this.opacity;\r\n        this._surfaceShader.u[\"uOpacity\"].value = this.opacity;\r\n    }\r\n\r\n    protected updateEta(): void {\r\n        this._sidesShader.u[\"uEta\"].value = this.eta;\r\n        this._surfaceShader.u[\"uEta\"].value = this.eta;\r\n\r\n        let F0 = (1 - this.eta) / (1 + this.eta);\r\n        F0 = F0 * F0;\r\n        this._sidesShader.u[\"uF0\"].value = F0;\r\n        this._surfaceShader.u[\"uF0\"].value = F0;\r\n    }\r\n}\r\n\r\nexport default Viewer3D;","import GLResource from \"../gl-utils/gl-resource\";\r\nimport Caustics from \"./caustics\";\r\n\r\nclass ViewerCommon extends GLResource {\r\n    private _caustics: Caustics;\r\n\r\n    private _tileTexture: WebGLTexture;\r\n\r\n    constructor(gl: WebGLRenderingContext, causticsRes: number, tileTexPath: string) {\r\n        function isPowerOf2(n) {\r\n            if (typeof n !== 'number')\r\n                return 'Not a number';\r\n\r\n            return n && (n & (n - 1)) === 0;\r\n        }\r\n\r\n        super(gl);\r\n\r\n        /* Create caustics */\r\n        this._caustics = new Caustics(gl, causticsRes, causticsRes);\r\n\r\n        /* Create tile texture. Default texture is blue 1x1 texture. */\r\n        this._tileTexture = gl.createTexture();\r\n        gl.bindTexture(gl.TEXTURE_2D, this._tileTexture);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 1, 1, 0, gl.RGBA, gl.UNSIGNED_BYTE, new Uint8Array([0, 0, 255, 255]));\r\n\r\n        const tileImg = new Image();\r\n        const tileTexture = this._tileTexture;\r\n        tileImg.onload = function () {\r\n            gl.bindTexture(gl.TEXTURE_2D, tileTexture);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, tileImg);\r\n\r\n            if (isPowerOf2(tileImg.width) && isPowerOf2(tileImg.height)) {\r\n                gl.generateMipmap(gl.TEXTURE_2D);\r\n            } else {\r\n                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\r\n                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);\r\n                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n            }\r\n        };\r\n        tileImg.src = tileTexPath;\r\n    }\r\n\r\n    public freeGLResources(): void {\r\n        const gl = super.gl(); //shortcut\r\n\r\n        this._caustics.freeGLResources();\r\n        this._caustics = null;\r\n\r\n        gl.deleteTexture(this._tileTexture);\r\n        this._tileTexture = null;\r\n    }\r\n\r\n    get caustics(): Caustics {\r\n        return this._caustics;\r\n    }\r\n\r\n    get tileTexture(): WebGLTexture {\r\n        return this._tileTexture;\r\n    }\r\n}\r\n\r\nexport default ViewerCommon;","import Shader from \"./gl-utils/shader\";\r\nimport VBO from \"./gl-utils/vbo\";\r\n\r\nconst encodeDecodeStr: string =\r\n    `const float HEIGHT_RANGE = 1.0;\r\nconst float VEL_RANGE = 0.25;\r\n\r\nstruct Cell {\r\n    float h; //height\r\n    float v; //velocity\r\n};\r\n\r\n/* Decodes a float value (16 bits in [0,1])\r\n * from a 2D value (2x8bits in [0,1]x[0,1]) */\r\nfloat decode16bit(vec2 v)\r\n{\r\n    const vec2 weights = 255.0 * vec2(256.0, 1.0) / (256.0*256.0 - 1.0);\r\n    return dot(weights, v);\r\n}\r\n\r\n/* Encodes a float value (16 bits in [0,1])\r\n * into a 2D value (2x8bits in [0,1]x[0,1]) */\r\nvec2 encode16bit(float f)\r\n{\r\n    const vec2 base = (256.0*256.0 - 1.0) / vec2(256.0, 1.0);\r\n    return floor(mod(f * base, 256.0)) / 255.0;\r\n}\r\n\r\nfloat decode(vec2 v, float range)\r\n{\r\n    return (2.0 * decode16bit(v) - 1.0) * range;\r\n}\r\n\r\nvec2 encode(float value, float range)\r\n{\r\n    return encode16bit(0.5 * value / range + 0.5);\r\n}\r\n\r\nfloat decodeHeight(vec4 texel)\r\n{\r\n    return decode(texel.rg, HEIGHT_RANGE);\r\n}\r\nvec2 encodeHeight(float h)\r\n{\r\n    return encode(h, HEIGHT_RANGE);\r\n}\r\n\r\nvec3 decodeNormal(vec4 texel, float amplitude)\r\n{\r\n    vec3 result = 2.0 * texel.rgb - 1.0;\r\n    return normalize(result * vec3(amplitude, amplitude, 1));\r\n}\r\nvec4 encodeNormal(vec3 n)\r\n{\r\n    return vec4(0.5 * n + 0.5, 1);\r\n}\r\n\r\nfloat decodeVelocity(vec4 texel)\r\n{\r\n    return decode(texel.ba, VEL_RANGE);\r\n}\r\nvec2 encodeVelocity(float h)\r\n{\r\n    return encode(h, VEL_RANGE);\r\n}\r\n\r\nCell decodeCell(vec4 texel)\r\n{\r\n    return Cell(decodeHeight(texel), decodeVelocity(texel));\r\n}\r\nvec4 encodeCell(Cell cell)\r\n{\r\n    return vec4(encodeHeight(cell.h), encodeVelocity(cell.v));\r\n}`;\r\n\r\nconst fullscreenVert: string =\r\n    `attribute vec2 aCorner; //{0,1}x{0,1}\r\n\r\nvarying vec2 sampleCoords;\r\n\r\nvoid main(void) {\r\n    sampleCoords = aCorner;\r\n    gl_Position = vec4(2.0*aCorner - 1.0, 0.0, 1.0);\r\n}`;\r\n\r\nconst touchFrag: string =\r\n    `precision mediump float;\r\n\r\nuniform sampler2D uWater;\r\n\r\nuniform vec2 uCoords;\r\nuniform vec2 uSize;\r\n\r\nvarying vec2 sampleCoords;\r\n\r\n___ENCODE_DECODE___\r\n\r\nvoid main(void) {\r\n    Cell cell = decodeCell(texture2D(uWater, sampleCoords));\r\n\r\n    float dist = length((sampleCoords - uCoords) / uSize);\r\n    dist = clamp(dist, 0.0, 1.0);\r\n\r\n    cell.h = mix(-0.6*HEIGHT_RANGE, cell.h, smoothstep(0.0, 1.0, dist));\r\n    cell.v *= step(1.0, dist);\r\n\r\n    gl_FragColor = encodeCell(cell);\r\n}`;\r\n\r\nconst updateFrag: string =\r\n    `precision mediump float;\r\n\r\nuniform sampler2D uPrevWater;\r\n\r\nuniform float uDt;\r\nuniform vec2 uTexelSize;\r\n\r\nuniform float uC; //surface tension\r\nuniform float uK; // vertical spring's stiffness\r\nuniform float uF; //friction\r\n\r\nvarying vec2 sampleCoords;\r\n\r\n___ENCODE_DECODE___\r\n\r\nvoid main(void) {\r\n    Cell cell = decodeCell(texture2D(uPrevWater, sampleCoords));\r\n\r\n    float neighbours = decodeHeight(texture2D(uPrevWater, sampleCoords + vec2(uTexelSize.x, 0))) +\r\n        decodeHeight(texture2D(uPrevWater, sampleCoords - vec2(uTexelSize.x, 0))) +\r\n        decodeHeight(texture2D(uPrevWater, sampleCoords + vec2(0, uTexelSize.y))) +\r\n        decodeHeight(texture2D(uPrevWater, sampleCoords - vec2(0, uTexelSize.y)));\r\n    neighbours *= 0.25;\r\n\r\n    /* Update velocity */\r\n    cell.v += -uDt * uK * cell.h; //vertical spring\r\n    cell.v += uDt * uC * (neighbours - cell.h); //surface tension\r\n    cell.v *= uF; //attenuation\r\n\r\n    /* Update position */\r\n    cell.h += uDt * cell.v;\r\n\r\n    gl_FragColor = encodeCell(cell);\r\n}`;\r\n\r\nconst normalsFrag: string =\r\n    `precision mediump float;\r\n\r\nuniform sampler2D uWater;\r\n\r\nuniform vec2 uTexelSize;\r\n\r\nvarying vec2 sampleCoords;\r\n\r\n___ENCODE_DECODE___\r\n\r\n/* Returns the normal, assuming the amplitude is 1. */\r\nvec3 computeNormal(vec2 coords)\r\n{\r\n    float dZx = decodeHeight(texture2D(uWater, coords + vec2(uTexelSize.x, 0))) -\r\n                decodeHeight(texture2D(uWater, coords - vec2(uTexelSize.x, 0)));\r\n    \r\n    float dZy = decodeHeight(texture2D(uWater, coords + vec2(0, uTexelSize.y))) -\r\n                decodeHeight(texture2D(uWater, coords - vec2(0, uTexelSize.y)));\r\n    \r\n    vec3 normal = cross(vec3(uTexelSize.x, 0, dZx), vec3(0, uTexelSize.y, dZy));\r\n    normal.xy *= 0.4 * HEIGHT_RANGE;\r\n\r\n    return normalize(normal);\r\n}\r\n\r\nvoid main(void) {\r\n    vec3 normal = computeNormal(sampleCoords);\r\n\r\n    gl_FragColor = encodeNormal(normal);\r\n}`;\r\n\r\nfunction buildTouchShader(gl: WebGLRenderingContext): Shader {\r\n    const vertSrc: string = fullscreenVert;\r\n    const fragSrc = touchFrag.replace(/___ENCODE_DECODE___/g, encodeDecodeStr);\r\n\r\n    const shader: Shader = new Shader(gl, vertSrc, fragSrc);\r\n    shader.a[\"aCorner\"].VBO = VBO.createQuad(gl, 0, 0, 1, 1);\r\n    return shader\r\n}\r\n\r\nfunction buildUpdateShader(gl: WebGLRenderingContext): Shader {\r\n    const vertSrc: string = fullscreenVert;\r\n    const fragSrc = updateFrag.replace(/___ENCODE_DECODE___/g, encodeDecodeStr);\r\n\r\n    const shader: Shader = new Shader(gl, vertSrc, fragSrc);\r\n    shader.a[\"aCorner\"].VBO = VBO.createQuad(gl, 0, 0, 1, 1);\r\n    return shader\r\n}\r\n\r\nfunction buildNormalsShader(gl: WebGLRenderingContext): Shader {\r\n    const vertSrc: string = fullscreenVert;\r\n    const fragSrc = normalsFrag.replace(/___ENCODE_DECODE___/g, encodeDecodeStr);\r\n\r\n    const shader: Shader = new Shader(gl, vertSrc, fragSrc);\r\n    shader.a[\"aCorner\"].VBO = VBO.createQuad(gl, 0, 0, 1, 1);\r\n    return shader\r\n}\r\n\r\nexport {\r\n    encodeDecodeStr,\r\n    buildTouchShader,\r\n    buildUpdateShader,\r\n    buildNormalsShader,\r\n};","import GLResource from \"./gl-utils/gl-resource\";\r\nimport FBO from \"./gl-utils/fbo\";\r\nimport Shader from \"./gl-utils/shader\";\r\nimport * as ShaderBuilder from \"./water-shaders\";\r\n\r\nclass Water extends GLResource {\r\n    private _width: number;\r\n    private _height: number;\r\n\r\n    private _FBO: FBO;\r\n\r\n    private _normalsTex: WebGLTexture;\r\n    private _heightmapsTex: WebGLTexture[];\r\n    private _currIndex: number;\r\n\r\n    private _touchShader: Shader;\r\n    private _updateShader: Shader;\r\n    private _normalsShader: Shader;\r\n\r\n    private _surfaceTension: number;\r\n    private _springStiffness: number;\r\n    private _dispersion: number;\r\n\r\n    public rain: boolean;\r\n\r\n    constructor(gl: WebGLRenderingContext, w: number, h: number) {\r\n        super(gl);\r\n\r\n        this._FBO = new FBO(gl, w, h);\r\n        this._touchShader = ShaderBuilder.buildTouchShader(gl);\r\n        this._updateShader = ShaderBuilder.buildUpdateShader(gl);\r\n        this._normalsShader = ShaderBuilder.buildNormalsShader(gl);\r\n\r\n        this.surfaceTension = 20.0;\r\n        this.springStiffness = 0.1;\r\n        this.dispersion = 0.999;\r\n\r\n        this.rain = true;\r\n\r\n        this.reset(w, h);\r\n    }\r\n\r\n    public freeGLResources(): void {\r\n        if (this._FBO) {\r\n            this._FBO.freeGLResources();\r\n        }\r\n\r\n        this.freeTextures();\r\n        this.freeShaders();\r\n    }\r\n\r\n    private freeTextures(): void {\r\n        const gl = super.gl(); //shortcut\r\n\r\n        if (this._normalsTex) {\r\n            gl.deleteTexture(this._normalsTex);\r\n        }\r\n        if (this._heightmapsTex) {\r\n            gl.deleteTexture(this._heightmapsTex[0]);\r\n            gl.deleteTexture(this._heightmapsTex[1]);\r\n        }\r\n    }\r\n\r\n    private freeShaders(): void {\r\n        if (this._touchShader) {\r\n            this._touchShader.freeGLResources();\r\n        }\r\n\r\n        if (this._updateShader) {\r\n            this._updateShader.freeGLResources();\r\n        }\r\n    }\r\n\r\n    public update(dt: number): void {\r\n        const gl = this.gl(); //shortcut\r\n\r\n        gl.disable(gl.CULL_FACE);\r\n        gl.disable(gl.DEPTH_TEST);\r\n\r\n        if (this.rain && Math.random() < 0.1) {\r\n            this.touch(Math.random() * this.width, Math.random() * this.height, 8);\r\n        }\r\n\r\n        const updateShader = this._updateShader;\r\n\r\n        updateShader.u[\"uPrevWater\"].value = this.currHeightmap;\r\n        updateShader.u[\"uDt\"].value = dt * 10;\r\n\r\n        this._FBO.bind([this.nextHeightmap]);\r\n        updateShader.use();\r\n        updateShader.bindUniformsAndAttributes();\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n\r\n        this.switchHeightmaps();\r\n\r\n        this.computeNormals();\r\n    }\r\n\r\n    private computeNormals(): void {\r\n        const gl = this.gl(); //shortcut\r\n        const shader = this._normalsShader;\r\n\r\n        shader.u[\"uWater\"].value = this.currHeightmap;\r\n\r\n        this._FBO.bind([this._normalsTex]);\r\n        shader.use();\r\n        shader.bindUniformsAndAttributes();\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n    }\r\n\r\n    public touch(coordX: number, coordY: number, radius: number): void {\r\n        const gl = this.gl(); //shortcut\r\n        const touchShader = this._touchShader;\r\n\r\n        touchShader.u[\"uWater\"].value = this.currHeightmap;\r\n        touchShader.u[\"uCoords\"].value = [coordX / this.width, coordY / this.height];\r\n        touchShader.u[\"uSize\"].value = [radius / this.width, radius / this.height];\r\n\r\n        this._FBO.bind([this.nextHeightmap]);\r\n        touchShader.use();\r\n        touchShader.bindUniformsAndAttributes();\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n\r\n        this.switchHeightmaps();\r\n        this.computeNormals();\r\n    }\r\n\r\n    get width(): number {\r\n        return this._width;\r\n    }\r\n\r\n    get height(): number {\r\n        return this._height;\r\n    }\r\n\r\n    set surfaceTension(c: number) {\r\n        this._surfaceTension = c;\r\n        this._updateShader.u[\"uC\"].value = c;\r\n    }\r\n    set springStiffness(k: number) {\r\n        this._springStiffness = k;\r\n        this._updateShader.u[\"uK\"].value = k;\r\n    }\r\n    set dispersion(f: number) {\r\n        this._dispersion = f;\r\n        this._updateShader.u[\"uF\"].value = f;\r\n    }\r\n\r\n    get surfaceTension(): number {\r\n        return this._surfaceTension;\r\n    }\r\n    get springStiffness(): number {\r\n        return this._springStiffness;\r\n    }\r\n    get dispersion(): number {\r\n        return this._dispersion;\r\n    }\r\n\r\n    get heightmap(): WebGLTexture {\r\n        return this._heightmapsTex[this._currIndex];\r\n    }\r\n\r\n    get normalmap(): WebGLTexture {\r\n        return this._normalsTex;\r\n    }\r\n\r\n    private get currHeightmap(): WebGLTexture {\r\n        return this._heightmapsTex[this._currIndex];\r\n    }\r\n\r\n    private get nextHeightmap(): WebGLTexture {\r\n        return this._heightmapsTex[(this._currIndex + 1) % 2];\r\n    }\r\n\r\n    private switchHeightmaps(): void {\r\n        this._currIndex = (this._currIndex + 1) % 2;\r\n    }\r\n\r\n    public reset(w: number, h: number): void {\r\n        this.freeTextures();\r\n\r\n        const gl = super.gl(); //shortcut\r\n\r\n        this._width = w;\r\n        this._height = h;\r\n        this._FBO.width = w;\r\n        this._FBO.height = h;\r\n\r\n        this._updateShader.u[\"uTexelSize\"].value = [1 / w, 1 / h];\r\n        this._normalsShader.u[\"uTexelSize\"].value = [1 / w, 1 / h];\r\n\r\n        const uintTexels: number[] = new Array(4 * w * h);\r\n        for (let i = 0; i < uintTexels.length;  ++i) {\r\n            uintTexels[i] = 127;\r\n        }\r\n        const uintData = new Uint8Array(uintTexels);\r\n\r\n        const wrap = gl.REPEAT;\r\n        const filter = gl.LINEAR;\r\n        let textures: WebGLTexture[] = [];\r\n        for (let i = 0; i < 2; ++i) {\r\n            let texture = gl.createTexture();\r\n            gl.bindTexture(gl.TEXTURE_2D, texture);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, w, h, 0,\r\n                gl.RGBA, gl.UNSIGNED_BYTE, uintData);\r\n            textures.push(texture);\r\n        }\r\n        {\r\n            let texture = gl.createTexture();\r\n            gl.bindTexture(gl.TEXTURE_2D, texture);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGB, w, h, 0,\r\n                gl.RGB, gl.UNSIGNED_BYTE, uintData);\r\n            textures.push(texture);\r\n        }\r\n\r\n        for (let iT of textures) {\r\n            gl.bindTexture(gl.TEXTURE_2D, iT);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filter);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filter);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, wrap);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, wrap);\r\n        }\r\n\r\n        this._normalsTex = textures[2];\r\n        this._heightmapsTex = [textures[0], textures[1]];\r\n        this._currIndex = 0;\r\n\r\n        this.computeNormals();\r\n    }\r\n}\r\n\r\nexport default Water;"],"sourceRoot":""}